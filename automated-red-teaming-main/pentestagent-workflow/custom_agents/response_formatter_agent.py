import os
from typing import Type
from pydantic import BaseModel

from agno.agent import Agent
from custom_models.litellm_with_retry import LiteLLMWithRetry


class ResponseFormatterAgent(Agent):
    def __init__(
        self, response_model: Type[BaseModel], debug_mode=True, *args, **kwargs
    ):
        """
        Extend Agno Agent to format input based on response_model.

        Usage Example:
        response_formatter_agent = ResponseFormatterAgent(response_model=<your response model>)
        agent_output = agent.run(prompt)
        final_resp = response_formatter_agent.run(agent_output)

        Args:
            response_model (Type[BaseModel]): To format input based on response_model.
            debug_mode (bool): Enable Agno's debug mode for the agent.
        """

        self.name = "Response Formatter Agent"
        self.model_id = os.getenv("MODEL_ID")

        super().__init__(
            name=self.name,
            model=LiteLLMWithRetry(
                id=self.model_id,
                api_base=os.getenv("LITELLM_API_BASE"),
                api_key=os.getenv("LITELLM_API_KEY"),
                temperature=int(os.getenv("MODEL_TEMPERATURE", 0)),
            ),
            goal="Format input into the corresponding response model specified.",
            success_criteria="Successfully format input into the corresponding response model specified.",
            instructions="Format given input string into the corresponding response model specified.",
            response_model=response_model,
            debug_mode=debug_mode,
            *args,
            **kwargs,
        )
