from enum import Enum
from typing import Optional, List
from pydantic import BaseModel, Field


# For SQLi Diagnostic Phase
class DiagnosticSQLiPayload(BaseModel):
    payload: str = Field(..., description="The raw SQL injection payload used.")
    potentially_vulnerable: bool = Field(
        ...,
        description="Indicates if the payload provides evidence of potential vulnerabilities to SQL injection.",
    )
    explanation: str = Field(
        ...,
        description="Explanation of what the payload does and its response did or did not indicate a vulnerability.",
    )


class DiagnosticSQLiResult(BaseModel):
    analysis: str = Field(
        ...,
        description="Summary of conclusion from diagnostic tests. Regardless of potential vulnerability, any additional areas for further testing should be noted here.",
    )
    exploit_payloads: List[DiagnosticSQLiPayload] = Field(
        ..., description="List of payloads that may have triggered SQLi-like behavior."
    )


# For SQLi Advanced Phase
class SQLiType(str, Enum):
    CLASSIC = "Classic SQL Injection"
    BLIND_BOOLEAN = "Blind SQL Injection (Boolean-Based)"
    BLIND_TIME = "Blind SQL Injection (Time-Based)"
    ERROR_BASED = "Error-Based SQL Injection"
    UNION_BASED = "Union-Based SQL Injection"
    OUT_OF_BAND = "Out-of-Band SQL Injection"
    STACKED_QUERIES = "Stacked Queries SQL Injection"
    INLINE_COMMENT = "Inline Comment SQL Injection"
    SECOND_ORDER = "Second-Order SQL Injection"
    OTHER = "Other"


class SQLiResult(BaseModel):
    url: str = Field(..., description="Target URL")
    method: str = Field(
        ..., description="HTTP method used for the request (e.g., GET, POST)"
    )
    param: str = Field(..., description="The parameter being targeted")
    payload: str = Field(
        ..., description="The payload used to test or exploit the SQL injection"
    )
    potentially_vulnerable: bool = Field(
        ..., description="Indicates if the parameter is likely vulnerable"
    )
    sqli_type: SQLiType = Field(..., description="The type of SQL injection detected")
    notes: str = Field(
        ...,
        description="Additional information about the payload test, including any key information or results from successful exploits such as leaked credentials.",
    )


class SQLiResultList(BaseModel):
    param_result_list: List[SQLiResult]
