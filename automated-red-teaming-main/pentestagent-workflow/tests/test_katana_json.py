from schema.recon import KatanaEndpointMetadata, KatanaAnalysisOutput, KatanaEndpointInfo
import json

json_line = {"url": "webscraper.io", "metadata": {"timestamp":                       
      "2025-07-15T15:28:17.050308+08:00", "method": "GET", "endpoint": "https://webscraper.io/", "tag": "a", "attribute": "href", "source":               
      "https://webscraper.io/test-sites", "status": 200, "content_type": "text/html; charset=UTF-8", "content_length": 55581, "cache_control":            
      "max-age=300, public", "hsts": "max-age=47474747; includeSubDomains; preload", "technologies": ["HSTS", "Amazon CloudFront", "Amazon Web Services", 
      "YouTube", "Google Tag Manager", "HTTP/3"]}, "queries": {}}

def main():
    metadata = KatanaEndpointMetadata(
        method=json_line["metadata"]["method"],
        endpoint=json_line["metadata"]["endpoint"],
        timestamp=json_line["metadata"]["timestamp"],
        tag=json_line["metadata"].get("tag"),
        attribute=json_line["metadata"].get("attribute"),
        source=json_line["metadata"].get("source"),
        status=json_line["metadata"].get("status"),
        content_type=json_line["metadata"].get("content_type"),
        content_length=json_line["metadata"].get("content_length"),
        cache_control=json_line["metadata"].get("cache_control"),
        hsts=json_line["metadata"].get("hsts"),
        technologies=json_line["metadata"].get("technologies"),
    )


    endpoint = KatanaEndpointInfo(
        url=json_line["url"],
        metadata=metadata
    )

    results = KatanaAnalysisOutput(endpoints=[endpoint])

    print(json.dumps(results.model_dump(), indent=2))

if __name__ == "__main__":
    main()