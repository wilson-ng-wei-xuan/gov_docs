from main import init_db, initialize_new_session
from collections import deque
from dotenv import load_dotenv
from custom_agents.dorking.dorking import run_dorking_agent
from schema.recon import KatanaAnalysisOutput, KatanaEndpoint, KatanaEndpointMethod
import asyncio


load_dotenv()
init_db()
queue = deque()

endpoints = [
    # KatanaEndpoint(
    #     url="https://hackthebox.com/sau"
    # ),
    KatanaEndpoint(
        url="https://github.com/xiaonanln",
        methods=[KatanaEndpointMethod(method="test_method_1")]
    ),
    KatanaEndpoint(
        url="https://github.com/xiaonanln/goworld/blob/master/rsa.key",
        methods=[KatanaEndpointMethod(method="test_method_2")]
    ),
    KatanaEndpoint(
        url="https://github.com/xiaonanln/goworld/blob",
        methods=[KatanaEndpointMethod(method="test_method_3")]
    )
]
test = KatanaAnalysisOutput(endpoints = endpoints)
sess_id = initialize_new_session(queue)
response = asyncio.run(run_dorking_agent(katana_output=test, session_id=sess_id))
