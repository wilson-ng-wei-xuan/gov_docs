from custom_agents.recon.recon import run_recon_agent
from schema.recon import KatanaAnalysisOutput


sample_input = {
    "endpoints": [
        {
            "url": "www.coldwear.com.sg/index.php",
            "technologies": [
                "PHP",
                "jQuery:1.7.1",
                "Google Analytics",
                "HSTS"
            ],
            "methods": [
                {
                    "method": "GET",
                    "enctype": null,
                    "parameters": [
                        {
                            "route": [
                                "account/account",
                                "account/address",
                                "account/edit",
                                "account/forgotten",
                                "account/login",
                                "account/order",
                                "account/order/search",
                                "account/order/search_order",
                                "account/password",
                                "account/register",
                                "account/register/country",
                                "account/return/insert",
                                "account/return/search",
                                "account/wishlist",
                                "checkout/cart",
                                "checkout/cart/add",
                                "checkout/checkout",
                                "common/header/search",
                                "common/store_home/complete_product",
                                "common/store_home/related_product",
                                "information/contact",
                                "information/information",
                                "information/outlet",
                                "information/sitemap",
                                "module/captcha/generate",
                                "module/enquiry/send",
                                "module/review/load_review",
                                "module/review/write",
                                "nspro/subscriber",
                                "product/categoryinfinite",
                                "product/categoryinfinite/buildList",
                                "product/compare",
                                "product/product",
                                "product/product/additional_image",
                                "product/product/getAvailableOption",
                                "product/product/getOptionPrice",
                                "product/product/updatePrice",
                                "product/searchinfinite",
                                "product/searchinfinite/buildList",
                                "redemption/redemption/getRedemptionIdbyAppId",
                                "redemption/request_coupon/add"
                            ]
                        },
                        {
                            "filter_name": [
                                "fleece"
                            ]
                        },
                        {
                            "parent_route": [
                                "account_order_search",
                                "contact",
                                "enquiry",
                                "forgotten",
                                "login",
                                "register",
                                "return",
                                "review"
                            ]
                        },
                        {
                            "information_id": [
                                "152"
                            ]
                        },
                        {
                            "category_id": [
                                "2019",
                                "2021",
                                "2023",
                                "2024",
                                "2025",
                                "2026",
                                "2027"
                            ]
                        },
                        {
                            "product_id": [
                                "35303",
                                "36744",
                                "36759",
                                "48779",
                                "60211",
                                "60217",
                                "70104",
                                "70127",
                                "70131",
                                "71967",
                                "72000",
                                "72106",
                                "72590",
                                "72680",
                                "74239",
                                "74268",
                                "75724",
                                "75734",
                                "75742",
                                "75750",
                                "75843",
                                "75938",
                                "76104",
                                "76164",
                                "76233",
                                "76244",
                                "76245",
                                "76258",
                                "76260",
                                "76271",
                                "76280",
                                "76431"
                            ]
                        },
                        {
                            "country_id": [
                                "EXPR"
                            ]
                        }
                    ],
                    "parameter_sets": [
                        "category_id=2019&route=product%2Fcategoryinfinite",
                        "category_id=2021&route=product%2Fcategoryinfinite",
                        "category_id=2023&route=product%2Fcategoryinfinite",
                        "category_id=2024&route=product%2Fcategoryinfinite",
                        "category_id=2025&route=product%2Fcategoryinfinite",
                        "category_id=2026&route=product%2Fcategoryinfinite",
                        "category_id=2027&route=product%2Fcategoryinfinite",
                        "country_id=EXPR&route=account%2Fregister%2Fcountry",
                        "filter_name=fleece&route=product%2Fsearchinfinite",
                        "information_id=152&route=information%2Finformation",
                        "parent_route=account_order_search&route=module%2Fcaptcha%2Fgenerate",
                        "parent_route=contact&route=module%2Fcaptcha%2Fgenerate",
                        "parent_route=enquiry&route=module%2Fcaptcha%2Fgenerate",
                        "parent_route=forgotten&route=module%2Fcaptcha%2Fgenerate",
                        "parent_route=login&route=module%2Fcaptcha%2Fgenerate",
                        "parent_route=register&route=module%2Fcaptcha%2Fgenerate",
                        "parent_route=return&route=module%2Fcaptcha%2Fgenerate",
                        "parent_route=review&route=module%2Fcaptcha%2Fgenerate",
                        "product_id=35303&route=module%2Freview%2Fload_review",
                        "product_id=35303&route=module%2Freview%2Fwrite",
                        "product_id=35303&route=product%2Fproduct",
                        "product_id=35303&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=35303&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=36744&route=module%2Freview%2Fload_review",
                        "product_id=36744&route=module%2Freview%2Fwrite",
                        "product_id=36744&route=product%2Fproduct",
                        "product_id=36744&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=36744&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=36759&route=module%2Freview%2Fload_review",
                        "product_id=36759&route=module%2Freview%2Fwrite",
                        "product_id=36759&route=product%2Fproduct",
                        "product_id=36759&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=36759&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=48779&route=module%2Freview%2Fload_review",
                        "product_id=48779&route=module%2Freview%2Fwrite",
                        "product_id=48779&route=product%2Fproduct",
                        "product_id=48779&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=48779&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=60211&route=module%2Freview%2Fload_review",
                        "product_id=60211&route=module%2Freview%2Fwrite",
                        "product_id=60211&route=product%2Fproduct",
                        "product_id=60211&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=60211&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=60217&route=module%2Freview%2Fload_review",
                        "product_id=60217&route=module%2Freview%2Fwrite",
                        "product_id=60217&route=product%2Fproduct",
                        "product_id=60217&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=60217&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=70104&route=module%2Freview%2Fload_review",
                        "product_id=70104&route=module%2Freview%2Fwrite",
                        "product_id=70104&route=product%2Fproduct",
                        "product_id=70104&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=70104&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=70127&route=module%2Freview%2Fload_review",
                        "product_id=70127&route=module%2Freview%2Fwrite",
                        "product_id=70127&route=product%2Fproduct",
                        "product_id=70127&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=70127&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=70131&route=module%2Freview%2Fload_review",
                        "product_id=70131&route=module%2Freview%2Fwrite",
                        "product_id=70131&route=product%2Fproduct",
                        "product_id=70131&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=70131&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=71967&route=module%2Freview%2Fload_review",
                        "product_id=71967&route=module%2Freview%2Fwrite",
                        "product_id=71967&route=product%2Fproduct",
                        "product_id=71967&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=71967&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=72000&route=module%2Freview%2Fload_review",
                        "product_id=72000&route=module%2Freview%2Fwrite",
                        "product_id=72000&route=product%2Fproduct",
                        "product_id=72000&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=72000&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=72106&route=module%2Freview%2Fload_review",
                        "product_id=72106&route=module%2Freview%2Fwrite",
                        "product_id=72106&route=product%2Fproduct",
                        "product_id=72106&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=72106&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=72590&route=module%2Freview%2Fload_review",
                        "product_id=72590&route=module%2Freview%2Fwrite",
                        "product_id=72590&route=product%2Fproduct",
                        "product_id=72590&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=72590&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=72680&route=module%2Freview%2Fload_review",
                        "product_id=72680&route=module%2Freview%2Fwrite",
                        "product_id=72680&route=product%2Fproduct",
                        "product_id=72680&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=72680&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=74239&route=module%2Freview%2Fload_review",
                        "product_id=74239&route=module%2Freview%2Fwrite",
                        "product_id=74239&route=product%2Fproduct",
                        "product_id=74239&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=74239&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=74268&route=module%2Freview%2Fload_review",
                        "product_id=74268&route=module%2Freview%2Fwrite",
                        "product_id=74268&route=product%2Fproduct",
                        "product_id=74268&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=74268&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=75724&route=module%2Freview%2Fload_review",
                        "product_id=75724&route=module%2Freview%2Fwrite",
                        "product_id=75724&route=product%2Fproduct",
                        "product_id=75724&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=75724&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=75734&route=module%2Freview%2Fload_review",
                        "product_id=75734&route=module%2Freview%2Fwrite",
                        "product_id=75734&route=product%2Fproduct",
                        "product_id=75734&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=75734&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=75742&route=module%2Freview%2Fload_review",
                        "product_id=75742&route=module%2Freview%2Fwrite",
                        "product_id=75742&route=product%2Fproduct",
                        "product_id=75742&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=75742&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=75750&route=module%2Freview%2Fload_review",
                        "product_id=75750&route=module%2Freview%2Fwrite",
                        "product_id=75750&route=product%2Fproduct",
                        "product_id=75750&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=75750&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=75843&route=module%2Freview%2Fload_review",
                        "product_id=75843&route=module%2Freview%2Fwrite",
                        "product_id=75843&route=product%2Fproduct",
                        "product_id=75843&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=75843&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=75938&route=module%2Freview%2Fload_review",
                        "product_id=75938&route=module%2Freview%2Fwrite",
                        "product_id=75938&route=product%2Fproduct",
                        "product_id=75938&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=75938&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=76104&route=module%2Freview%2Fload_review",
                        "product_id=76104&route=module%2Freview%2Fwrite",
                        "product_id=76104&route=product%2Fproduct",
                        "product_id=76104&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=76104&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=76164&route=module%2Freview%2Fload_review",
                        "product_id=76164&route=module%2Freview%2Fwrite",
                        "product_id=76164&route=product%2Fproduct",
                        "product_id=76164&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=76164&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=76233&route=module%2Freview%2Fload_review",
                        "product_id=76233&route=module%2Freview%2Fwrite",
                        "product_id=76233&route=product%2Fproduct",
                        "product_id=76233&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=76233&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=76244&route=module%2Freview%2Fload_review",
                        "product_id=76244&route=module%2Freview%2Fwrite",
                        "product_id=76244&route=product%2Fproduct",
                        "product_id=76244&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=76244&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=76245&route=module%2Freview%2Fload_review",
                        "product_id=76245&route=module%2Freview%2Fwrite",
                        "product_id=76245&route=product%2Fproduct",
                        "product_id=76245&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=76245&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=76258&route=module%2Freview%2Fload_review",
                        "product_id=76258&route=module%2Freview%2Fwrite",
                        "product_id=76258&route=product%2Fproduct",
                        "product_id=76258&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=76258&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=76260&route=module%2Freview%2Fload_review",
                        "product_id=76260&route=module%2Freview%2Fwrite",
                        "product_id=76260&route=product%2Fproduct",
                        "product_id=76260&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=76260&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=76271&route=module%2Freview%2Fload_review",
                        "product_id=76271&route=module%2Freview%2Fwrite",
                        "product_id=76271&route=product%2Fproduct",
                        "product_id=76271&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=76271&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=76280&route=module%2Freview%2Fload_review",
                        "product_id=76280&route=module%2Freview%2Fwrite",
                        "product_id=76280&route=product%2Fproduct",
                        "product_id=76280&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=76280&route=product%2Fproduct%2FgetOptionPrice",
                        "product_id=76431&route=module%2Freview%2Fload_review",
                        "product_id=76431&route=module%2Freview%2Fwrite",
                        "product_id=76431&route=product%2Fproduct",
                        "product_id=76431&route=product%2Fproduct%2FgetAvailableOption",
                        "product_id=76431&route=product%2Fproduct%2FgetOptionPrice",
                        "route=account%2Faccount",
                        "route=account%2Faddress",
                        "route=account%2Fedit",
                        "route=account%2Fforgotten",
                        "route=account%2Flogin",
                        "route=account%2Forder",
                        "route=account%2Forder%2Fsearch",
                        "route=account%2Forder%2Fsearch_order",
                        "route=account%2Fpassword",
                        "route=account%2Fregister",
                        "route=account%2Fregister%2Fcountry",
                        "route=account%2Freturn%2Finsert",
                        "route=account%2Freturn%2Fsearch",
                        "route=account%2Fwishlist",
                        "route=checkout%2Fcart",
                        "route=checkout%2Fcart%2Fadd",
                        "route=checkout%2Fcheckout",
                        "route=common%2Fheader%2Fsearch",
                        "route=common%2Fstore_home%2Fcomplete_product",
                        "route=common%2Fstore_home%2Frelated_product",
                        "route=information%2Fcontact",
                        "route=information%2Foutlet",
                        "route=information%2Fsitemap",
                        "route=module%2Fenquiry%2Fsend",
                        "route=nspro%2Fsubscriber",
                        "route=product%2Fcategoryinfinite",
                        "route=product%2Fcategoryinfinite%2FbuildList",
                        "route=product%2Fcompare",
                        "route=product%2Fproduct",
                        "route=product%2Fproduct%2Fadditional_image",
                        "route=product%2Fproduct%2FupdatePrice",
                        "route=product%2Fsearchinfinite",
                        "route=product%2Fsearchinfinite%2FbuildList",
                        "route=redemption%2Fredemption%2FgetRedemptionIdbyAppId",
                        "route=redemption%2Frequest_coupon%2Fadd"
                    ]
                }
            ]
        }                    
    ]
}


def test_recon_agent_end_to_end():
    katana_analysis_output = KatanaAnalysisOutput.model_validate(sample_input)
    recon_output = run_recon_agent(katana_analysis_output, session_id="12345")
    with open("tmp/recon_output.json", "w") as f:
        f.write(recon_output.model_dump_json(indent=2))

if __name__ == "__main__":
    test_recon_agent_end_to_end()