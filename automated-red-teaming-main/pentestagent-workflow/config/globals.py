import os 
from dotenv import load_dotenv
load_dotenv()

from db.dynamo import DynamoDB
from db.s3 import S3Storage
import logging

logger = logging.getLogger(__name__)

# Global Configurations
DEBUG_MODE = os.getenv("DEBUG_MODE", "false").lower() == "true"
STREAM_RESPONSES = os.getenv("STREAM_RESPONSES", "false").lower() == "true"
USE_DB = os.getenv("USE_DB", "false").lower() == "true"

if USE_DB:
    try:
        DYNAMO_DB = DynamoDB(
            table_name=os.getenv("DYNAMO_TABLE_NAME", "maya-apt"), 
            pk='session_id', 
            sk='node_id'
            )  
    except:
        logger.error('Failed to initialize DynamoDB when USE_DB=True. Check that DB parameters are correct.')
        raise

    try:
        S3 = S3Storage(
            region='ap-southeast-1'
            )   
    except:
        logger.error('Failed to initialize S3 when USE_DB=True. Check that S3 parameters are correct.')
        raise
else:
    DYNAMO_DB = None
    S3 = None