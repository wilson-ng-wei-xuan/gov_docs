from __future__ import annotations

import asyncio
from server.sink.schema import StreamSink, NullSink
from typing import Dict, Optional, TYPE_CHECKING
import contextvars

if TYPE_CHECKING:
    from schema.state import PentestNode
from db.dynamo import DynamoDB
import time 

# Context Variables for usage in asyncio contexts
current_session_id: contextvars.ContextVar[Optional[str]] = contextvars.ContextVar(
    "current_session", default=None
)
current_sink: contextvars.ContextVar[StreamSink] = contextvars.ContextVar(
    "current_sink", default=NullSink()
)
current_node:contextvars.ContextVar[Optional["PentestNode"]] = contextvars.ContextVar(
    "current_node", default=None
)
current_actions: contextvars.ContextVar[Dict[str, asyncio.Future]] = contextvars.ContextVar(
    "current_actions", default=dict()
)
current_model: contextvars.ContextVar[Optional[str]] = contextvars.ContextVar(
    "current_model", default=None
)
current_run_id: contextvars.ContextVar[Optional[str]] = contextvars.ContextVar(
    "current_run_id", default=None
)
